#!/bin/bash

# Define the disk
DISK="/dev/nvme0n1"

# Wipe existing filesystems
wipefs -a $DISK

# Create the partition table
sfdisk $DISK << EOF
,1G,U
,8G,S
,100G,L
,,L
EOF

# Format the partitions
mkfs.fat -F32 ${DISK}p1
mkswap ${DISK}p2
mkfs.ext4 ${DISK}p3

# Encrypt the home partition
cryptsetup luksFormat ${DISK}p4
cryptsetup open ${DISK}p4 home_crypt
mkfs.ext4 /dev/mapper/home_crypt

# Mount the partitions
mount ${DISK}p3 /mnt
mount --mkdir ${DISK}p1 /mnt/boot
swapon ${DISK}p2
mount --mkdir /dev/mapper/home_crypt /mnt/home

echo "Partitions have been created, formatted, encrypted, and mounted."
