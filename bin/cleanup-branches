#!/bin/bash
source "$HOME/newdotfiles/common/update-upstream"

# Find master worktree (works in both bash and zsh)
find_master_worktree() {
	local wt=""
	while IFS= read -r line; do
		if [[ "$line" == worktree\ * ]]; then
			wt="${line#worktree }"
		elif [[ "$line" == "branch refs/heads/master" ]]; then
			echo "$wt"
			return 0
		fi
	done < <(git worktree list --porcelain)
	return 1
}

master_worktree=$(find_master_worktree)

if [[ -n "$master_worktree" ]]; then
	# Worktree mode: cd to master worktree and pull
	cd "$master_worktree"
	git fetch --all --prune
	git pull
else
	# Regular mode: checkout master and pull
	git ch master
	updateUpstream
fi
